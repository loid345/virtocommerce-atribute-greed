<div class="blade-content">
  <div class="blade-inner">
    <div class="inner-block">
      <div class="form-inline" style="padding: 10px; background: #f5f5f5; border-bottom: 1px solid #ddd; display: flex; gap: 10px; flex-wrap: wrap; align-items: center;">
        <div class="form-group">
          <div class="input-group" style="width: 250px;">
            <span class="input-group-addon"><i class="fa fa-search"></i></span>
            <input type="text"
                   class="form-control"
                   ng-model="filter.keyword"
                   ng-model-options="{ debounce: 400 }"
                   ng-change="blade.refresh()"
                   placeholder="{{ 'AttributeGrid.blades.list.placeholders.search' | translate }}">
          </div>
        </div>

        <div class="form-group" style="min-width: 220px;">
          <ui-select ng-model="filter.catalogId"
                     ng-change="blade.refresh()"
                     theme="select2">
            <ui-select-match allow-clear="true" placeholder="{{ 'AttributeGrid.blades.list.placeholders.allCatalogs' | translate }}">
              {{$select.selected.name}}
            </ui-select-match>
            <ui-select-choices repeat="cat.id as cat in catalogs | filter: $select.search">
              <span ng-bind-html="cat.name | highlight: $select.search"></span>
            </ui-select-choices>
          </ui-select>
        </div>

        <div class="form-group">
          <select class="form-control"
                  ng-model="filter.valueType"
                  ng-change="blade.refresh()"
                  style="width: 140px;">
            <option value="">{{ 'AttributeGrid.blades.list.placeholders.allTypes' | translate }}</option>
            <option value="ShortText">{{ 'AttributeGrid.blades.list.valueTypes.shortText' | translate }}</option>
            <option value="LongText">{{ 'AttributeGrid.blades.list.valueTypes.longText' | translate }}</option>
            <option value="Number">{{ 'AttributeGrid.blades.list.valueTypes.number' | translate }}</option>
            <option value="DateTime">{{ 'AttributeGrid.blades.list.valueTypes.dateTime' | translate }}</option>
            <option value="Boolean">{{ 'AttributeGrid.blades.list.valueTypes.boolean' | translate }}</option>
          </select>
        </div>

        <div class="btn-group" role="group" style="margin-left: auto;">
          <button class="btn btn-default"
                  type="button"
                  ng-disabled="!selectedItems.length"
                  ng-click="bulkUpdate({ isFilterable: true })">
            <i class="fa fa-filter text-success"></i>
            {{ 'AttributeGrid.commands.enableFilter' | translate }}
          </button>
          <button class="btn btn-default"
                  type="button"
                  ng-disabled="!selectedItems.length"
                  ng-click="bulkUpdate({ isFilterable: false })">
            <i class="fa fa-filter text-muted"></i>
            {{ 'AttributeGrid.commands.disableFilter' | translate }}
          </button>
          <button class="btn btn-default"
                  type="button"
                  ng-disabled="!selectedItems.length"
                  ng-click="bulkUpdate({ isRequired: true })">
            <i class="fa fa-asterisk text-warning"></i>
            {{ 'AttributeGrid.commands.enableRequired' | translate }}
          </button>
          <button class="btn btn-default"
                  type="button"
                  ng-disabled="!selectedItems.length"
                  ng-click="bulkUpdate({ isRequired: false })">
            <i class="fa fa-asterisk text-muted"></i>
            {{ 'AttributeGrid.commands.disableRequired' | translate }}
          </button>
          <button class="btn btn-danger"
                  type="button"
                  ng-disabled="!selectedItems.length"
                  ng-click="bulkDelete()">
            <i class="fa fa-trash"></i>
            {{ 'AttributeGrid.commands.deleteSelected' | translate }}
          </button>
        </div>

        <div style="color: #666;">
          <span ng-if="selectedItems.length" class="text-primary">
            <i class="fa fa-check-square"></i>
            {{ 'AttributeGrid.blades.list.selected' | translate }}: <strong>{{selectedItems.length}}</strong> |
          </span>
          {{ 'AttributeGrid.blades.list.total' | translate }}: <strong>{{pageSettings.totalItems}}</strong>
        </div>
      </div>

      <div class="table-responsive" style="max-height: calc(100vh - 280px); overflow-y: auto;">
        <table class="table table-hover table-striped" style="margin-bottom: 0;">
          <thead style="position: sticky; top: 0; background: #fff;">
            <tr>
              <th style="width: 40px; text-align: center;">
                <input type="checkbox"
                       ng-checked="selectAll"
                       ng-click="toggleSelectAll()">
              </th>
              <th>{{ 'AttributeGrid.blades.list.columns.name' | translate }}</th>
              <th style="width: 120px;">{{ 'AttributeGrid.blades.list.columns.type' | translate }}</th>
              <th>{{ 'AttributeGrid.blades.list.columns.owner' | translate }}</th>
              <th style="width: 70px; text-align: center;">{{ 'AttributeGrid.blades.list.columns.filterable' | translate }}</th>
              <th style="width: 70px; text-align: center;">{{ 'AttributeGrid.blades.list.columns.dictionary' | translate }}</th>
              <th style="width: 60px; text-align: right;">{{ 'AttributeGrid.blades.list.columns.usage' | translate }}</th>
              <th style="width: 50px;"></th>
            </tr>
          </thead>
          <tbody>
            <tr ng-repeat="item in blade.currentEntities"
                ng-click="blade.selectNode(item)"
                style="cursor: pointer;"
                ng-class="{'info': selectedNodeId === item.id}">
              <td style="text-align: center;">
                <input type="checkbox"
                       ng-checked="item.$selected"
                       ng-click="toggleSelect(item, $event)">
              </td>
              <td>
                <strong>{{item.name}}</strong>
                <div class="text-muted small">{{item.code}}</div>
              </td>
              <td>
                <span class="label" ng-class="{
                    'label-info': item.valueType === 'ShortText' || item.valueType === 'LongText',
                    'label-success': item.valueType === 'Boolean',
                    'label-warning': item.valueType === 'Number',
                    'label-default': item.valueType === 'DateTime'
                }">{{item.valueType}}</span>
                <span ng-if="item.isMultivalue"
                      class="badge"
                      title="{{ 'AttributeGrid.blades.list.multivalue' | translate }}"
                      style="background:#555; margin-left:2px;">M</span>
              </td>
              <td>
                <span class="text-muted">{{item.ownerPath || '—'}}</span>
              </td>
              <td style="text-align: center;">
                <i class="fa"
                   ng-class="item.isFilterable ? 'fa-check text-success' : 'fa-times text-muted'"
                   ng-click="toggleFilterable(item, $event)"
                   style="cursor: pointer;"
                   title="{{ 'AttributeGrid.blades.list.toggleFilterable' | translate }}"></i>
              </td>
              <td style="text-align: center;">
                <i class="fa fa-book text-info" ng-if="item.isDictionary" title="{{ 'AttributeGrid.blades.list.columns.dictionary' | translate }}"></i>
                <span ng-if="!item.isDictionary">—</span>
              </td>
              <td style="text-align: right;">
                <span class="badge">{{item.usageCount || 0}}</span>
              </td>
              <td>
                <button class="btn btn-xs btn-danger"
                        ng-click="deleteItem(item); $event.stopPropagation();"
                        title="{{ 'AttributeGrid.commands.deleteSelected' | translate }}">
                  <i class="fa fa-trash"></i>
                </button>
              </td>
            </tr>

            <tr ng-if="!blade.isLoading && (!blade.currentEntities || blade.currentEntities.length === 0)">
              <td colspan="8" class="text-center text-muted" style="padding: 40px;">
                <i class="fa fa-inbox fa-2x"></i>
                <p style="margin-top: 10px;">{{ 'AttributeGrid.blades.list.empty' | translate }}</p>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="text-center" style="padding: 10px; border-top: 1px solid #ddd;" ng-if="pageSettings.totalItems > pageSettings.itemsPerPageCount">
        <uib-pagination
            total-items="pageSettings.totalItems"
            ng-model="pageSettings.currentPage"
            items-per-page="pageSettings.itemsPerPageCount"
            ng-change="blade.refresh()"
            max-size="7"
            boundary-links="true"
            class="pagination-sm"
            style="margin: 0;">
        </uib-pagination>
      </div>
    </div>
  </div>
</div>
