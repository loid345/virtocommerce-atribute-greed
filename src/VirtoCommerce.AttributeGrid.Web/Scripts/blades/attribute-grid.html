<div class="blade-content">
  <div class="blade-inner">
    <div class="inner-block">
      <div class="form-inline" style="padding: 10px; background: #f5f5f5; border-bottom: 1px solid #ddd; display: flex; gap: 10px; flex-wrap: wrap; align-items: center;">
        <div class="form-group">
          <div class="input-group" style="width: 250px;">
            <span class="input-group-addon"><i class="fa fa-search"></i></span>
            <input type="text"
                   class="form-control"
                   ng-model="filter.keyword"
                   ng-model-options="{ debounce: 400 }"
                   ng-change="blade.refresh()"
                   placeholder="Поиск по имени...">
          </div>
        </div>

        <div class="form-group" style="min-width: 220px;">
          <ui-select ng-model="filter.catalogId"
                     ng-change="blade.refresh()"
                     theme="select2">
            <ui-select-match allow-clear="true" placeholder="— Все каталоги —">
              {{$select.selected.name}}
            </ui-select-match>
            <ui-select-choices repeat="cat.id as cat in catalogs | filter: $select.search">
              <span ng-bind-html="cat.name | highlight: $select.search"></span>
            </ui-select-choices>
          </ui-select>
        </div>

        <div class="form-group">
          <select class="form-control"
                  ng-model="filter.valueType"
                  ng-change="blade.refresh()"
                  style="width: 140px;">
            <option value="">— Все типы —</option>
            <option value="ShortText">Текст</option>
            <option value="LongText">Длинный текст</option>
            <option value="Number">Число</option>
            <option value="DateTime">Дата</option>
            <option value="Boolean">Да/Нет</option>
          </select>
        </div>

        <div style="margin-left: auto; color: #666;">
          Найдено: <strong>{{pageSettings.totalItems}}</strong>
        </div>
      </div>

      <div class="table-responsive" style="max-height: calc(100vh - 280px); overflow-y: auto;">
        <table class="table table-hover table-striped" style="margin-bottom: 0;">
          <thead style="position: sticky; top: 0; background: #fff;">
            <tr>
              <th>Имя</th>
              <th style="width: 120px;">Тип</th>
              <th>Владелец</th>
              <th style="width: 70px; text-align: center;">Фильтр</th>
              <th style="width: 70px; text-align: center;">Словарь</th>
              <th style="width: 60px; text-align: right;">Исп.</th>
              <th style="width: 50px;"></th>
            </tr>
          </thead>
          <tbody>
            <tr ng-repeat="item in blade.currentEntities"
                ng-click="blade.selectNode(item)"
                style="cursor: pointer;"
                ng-class="{'info': selectedNodeId === item.id}">
              <td>
                <strong>{{item.name}}</strong>
                <div class="text-muted small">{{item.code}}</div>
              </td>
              <td>
                <span class="label" ng-class="{
                    'label-info': item.valueType === 'ShortText',
                    'label-success': item.valueType === 'Number',
                    'label-warning': item.valueType === 'DateTime',
                    'label-default': item.valueType === 'Boolean'
                }">{{item.valueType}}</span>
              </td>
              <td>
                <span class="text-muted">{{item.ownerPath || '—'}}</span>
              </td>
              <td style="text-align: center;">
                <i class="fa"
                   ng-class="item.isFilterable ? 'fa-check text-success' : 'fa-times text-muted'"
                   ng-click="toggleFilterable(item, $event)"
                   style="cursor: pointer;"
                   title="Кликните для переключения"></i>
              </td>
              <td style="text-align: center;">
                <i class="fa fa-book text-info" ng-if="item.isDictionary" title="Словарь"></i>
                <span ng-if="!item.isDictionary">—</span>
              </td>
              <td style="text-align: right;">
                <span class="badge">{{item.usageCount || 0}}</span>
              </td>
              <td>
                <button class="btn btn-xs btn-danger"
                        ng-click="deleteItem(item); $event.stopPropagation();"
                        title="Удалить в корзину">
                  <i class="fa fa-trash"></i>
                </button>
              </td>
            </tr>

            <tr ng-if="!blade.isLoading && (!blade.currentEntities || blade.currentEntities.length === 0)">
              <td colspan="7" class="text-center text-muted" style="padding: 40px;">
                <i class="fa fa-inbox fa-2x"></i>
                <p style="margin-top: 10px;">Атрибуты не найдены</p>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="text-center" style="padding: 10px; border-top: 1px solid #ddd;" ng-if="pageSettings.totalItems > pageSettings.itemsPerPageCount">
        <uib-pagination
            total-items="pageSettings.totalItems"
            ng-model="pageSettings.currentPage"
            items-per-page="pageSettings.itemsPerPageCount"
            ng-change="blade.refresh()"
            max-size="7"
            boundary-links="true"
            class="pagination-sm"
            style="margin: 0;">
        </uib-pagination>
      </div>
    </div>
  </div>
</div>
